<button class="reglas-btn" aria-label="Ver reglas" (click)="openReglasModal()">?</button>
<button class="close" aria-label="Cerrar" (click)="close()">Ã—</button>

<!-- Imagen de fondo temÃ¡tica (capa mÃ¡s baja) -->
<div class="background-layer" [style.background-image]="'url(' + imagenFondo + ')'"></div>

<h2 class="title">ğŸ Regalo especial para ti</h2>
<p class="subtitle">Gira para obtener cupones de recompensa</p>

<div class="wheel-box" *ngIf="!error; else errorTpl">
  <!-- Contenedor de capas de ruleta -->
  <div class="wheel-container">
    <!-- Imagen de ruleta estÃ¡tica (capa intermedia) -->
    <div class="ruleta-layer" [style.background-image]="'url(' + imagenRuleta + ')'"></div>
    
    <!-- Ruleta funcional con lÃ³gica (capa superior) -->
    <app-ruleta 
      [segmentos]="segmentos" 
      [externalControl]="true"
      [disabled]="!isLogged || intentosDisponibles === null || intentosDisponibles <= 0"
      (spinClick)="onSpin()">
    </app-ruleta>
  </div>
</div>

<!-- Mensaje contextual FUERA de wheel-box -->
<div class="intentos-info">
  <small *ngIf="intentosCargando">Cargando intentosâ€¦</small>

  <ng-container *ngIf="!intentosCargando && !error">
    <small *ngIf="!isLogged">
      Inicia sesiÃ³n para poder girar la ruleta.
    </small>

    <small *ngIf="isLogged && (intentosDisponibles ?? -1) > 0">
      Intentos disponibles: {{ intentosDisponibles }}
    </small>

    <small *ngIf="isLogged && (intentosDisponibles ?? -1) === 0">
      No tienes intentos por el momento.
    </small>
  </ng-container>
</div>

<ng-template #errorTpl>
  <div class="error">{{ error }}</div>
</ng-template>

<p class="footnote" *ngIf="!error">âœ¨ 100% probabilidad de ganar</p>